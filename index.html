<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NRW Schulleitung Onboarding</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nrw-blue': '#3e76af',
                        'nrw-blue-light': '#5a8bc7',
                        'nrw-blue-dark': '#2c5a89',
                        'nrw-gray': '#f8f9fa',
                        'nrw-gray-dark': '#6c757d'
                    },
                    fontFamily: {
                        'sans': ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .icon {
            width: 1em;
            height: 1em;
            display: inline-block;
            line-height: 1;
            flex-shrink: 0;
            vertical-align: middle;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        }
        .nrw-gradient {
            background: linear-gradient(135deg, #3e76af 0%, #5a8bc7 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Simple icon components to replace lucide-react
        const IconWrapper = ({ children, className = "", ...props }) => (
            <svg className={`icon ${className}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {children}
            </svg>
        );

        const ChevronRight = ({ className }) => (
            <IconWrapper className={className}>
                <polyline points="9,18 15,12 9,6"></polyline>
            </IconWrapper>
        );

        const ChevronLeft = ({ className }) => (
            <IconWrapper className={className}>
                <polyline points="15,18 9,12 15,6"></polyline>
            </IconWrapper>
        );

        const Check = ({ className }) => (
            <IconWrapper className={className}>
                <polyline points="20,6 9,17 4,12"></polyline>
            </IconWrapper>
        );

        const Mail = ({ className }) => (
            <IconWrapper className={className}>
                <path d="m4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2h-16c-1.1 0-2-.9-2-2v-12c0-1.1.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
            </IconWrapper>
        );

        const Lock = ({ className }) => (
            <IconWrapper className={className}>
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <circle cx="12" cy="16" r="1"></circle>
                <path d="m7 11v-5a5 5 0 0 1 10 0v5"></path>
            </IconWrapper>
        );

        const Shield = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </IconWrapper>
        );

        const Users = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="m22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="m16 3.13a4 4 0 0 1 0 7.75"></path>
            </IconWrapper>
        );

        const Upload = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </IconWrapper>
        );

        const AlertCircle = ({ className }) => (
            <IconWrapper className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </IconWrapper>
        );

        const Eye = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </IconWrapper>
        );

        const EyeOff = ({ className }) => (
            <IconWrapper className={className}>
                <path d="m15.996 15.996-3.996-3.996-3.996 3.996"></path>
                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                <line x1="2" y1="2" x2="22" y2="22"></line>
            </IconWrapper>
        );

        const HelpCircle = ({ className }) => (
            <IconWrapper className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconWrapper>
        );

        const Phone = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </IconWrapper>
        );

        const MessageCircle = ({ className }) => (
            <IconWrapper className={className}>
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
            </IconWrapper>
        );

        const X = ({ className }) => (
            <IconWrapper className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </IconWrapper>
        );

        const Send = ({ className }) => (
            <IconWrapper className={className}>
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </IconWrapper>
        );

        const Bot = ({ className }) => (
            <IconWrapper className={className}>
                <rect x="3" y="8" width="18" height="13" rx="2"></rect>
                <path d="m7 16 3-3 3 3"></path>
                <path d="M8 2v2"></path>
                <path d="M16 2v2"></path>
                <circle cx="8" cy="11" r="1"></circle>
                <circle cx="16" cy="11" r="1"></circle>
            </IconWrapper>
        );

        const Minimize2 = ({ className }) => (
            <IconWrapper className={className}>
                <polyline points="4,14 10,14 10,20"></polyline>
                <polyline points="20,10 14,10 14,4"></polyline>
                <line x1="14" y1="10" x2="21" y2="3"></line>
                <line x1="3" y1="21" x2="10" y2="14"></line>
            </IconWrapper>
        );

        const OnboardingAssistant = () => {
          const [currentStep, setCurrentStep] = useState(0);
          const [formData, setFormData] = useState({
            schoolEmail: '',
            password: '',
            confirmPassword: '',
            twoFactorEnabled: false,
            inviteMethod: '',
            teacherEmails: '',
            schildFile: null
          });
          const [showPassword, setShowPassword] = useState(false);
          const [showConfirmPassword, setShowConfirmPassword] = useState(false);
          const [errors, setErrors] = useState({});
          const [showHelp, setShowHelp] = useState(false);
          const [showFAQ, setShowFAQ] = useState(false);
          const [showSupport, setShowSupport] = useState(false);
          const [showSupportBot, setShowSupportBot] = useState(false);
          const [botMessages, setBotMessages] = useState([]);
          const [userMessage, setUserMessage] = useState('');
          const [botIsTyping, setBotIsTyping] = useState(false);

          const steps = [
            {
              title: 'Anmeldung mit Schul-E-Mail',
              icon: Mail,
              description: 'Geben Sie Ihre offizielle Schul-E-Mail-Adresse ein'
            },
            {
              title: 'Passwort erstellen',
              icon: Lock,
              description: 'Erstellen Sie ein sicheres Passwort für Ihren Account'
            },
            {
              title: 'Zwei-Faktor-Authentifizierung',
              icon: Shield,
              description: 'Empfohlen: Sichern Sie Ihren Account zusätzlich ab'
            },
            {
              title: 'Lehrkräfte einladen',
              icon: Users,
              description: 'Laden Sie Ihre Lehrkräfte über SchiLD-Import oder manuell ein'
            }
          ];

          const validateEmail = (email) => {
            // Basic email format check
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) return false;
            
            // Check for NRW school domains
            const nrwSchoolDomains = ['.nrw.de', '.nrw.schule', '.schulen.de'];
            return nrwSchoolDomains.some(domain => email.toLowerCase().includes(domain));
          };

          const validatePassword = (password) => {
            return password.length >= 8 && 
                   /[A-Z]/.test(password) && 
                   /[a-z]/.test(password) && 
                   /[0-9]/.test(password) && 
                   /[^A-Za-z0-9]/.test(password);
          };

          const handleNext = () => {
            const newErrors = {};

            if (currentStep === 0) {
              if (!formData.schoolEmail) {
                newErrors.schoolEmail = 'E-Mail-Adresse ist erforderlich';
              } else if (!validateEmail(formData.schoolEmail)) {
                newErrors.schoolEmail = 'Bitte geben Sie eine gültige NRW-Schul-E-Mail-Adresse ein';
              }
            }

            if (currentStep === 1) {
              if (!formData.password) {
                newErrors.password = 'Passwort ist erforderlich';
              } else if (!validatePassword(formData.password)) {
                newErrors.password = 'Passwort muss mindestens 8 Zeichen enthalten: Groß-, Kleinbuchstaben, Zahlen und Sonderzeichen';
              }
              
              if (!formData.confirmPassword) {
                newErrors.confirmPassword = 'Passwort-Bestätigung ist erforderlich';
              } else if (formData.password !== formData.confirmPassword) {
                newErrors.confirmPassword = 'Passwörter stimmen nicht überein';
              }
            }

            if (currentStep === 3) {
              if (!formData.inviteMethod) {
                newErrors.inviteMethod = 'Bitte wählen Sie eine Einladungsmethode';
              } else if (formData.inviteMethod === 'manual' && !formData.teacherEmails.trim()) {
                newErrors.teacherEmails = 'Bitte geben Sie mindestens eine E-Mail-Adresse ein';
              } else if (formData.inviteMethod === 'schild' && !formData.schildFile) {
                newErrors.schildFile = 'Bitte wählen Sie eine SchiLD-Datei aus';
              }
            }

            setErrors(newErrors);

            if (Object.keys(newErrors).length === 0) {
              setCurrentStep(Math.min(currentStep + 1, steps.length));
            }
          };

          const handleBack = () => {
            setCurrentStep(Math.max(currentStep - 1, 0));
            setErrors({});
          };

          const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (file && (file.name.endsWith('.csv') || file.name.endsWith('.xlsx'))) {
              setFormData({ ...formData, schildFile: file });
              setErrors({ ...errors, schildFile: '' });
            } else {
              setErrors({ ...errors, schildFile: 'Bitte wählen Sie eine CSV- oder Excel-Datei aus' });
            }
          };

          const faqData = [
            {
              question: "Welche E-Mail-Adresse sollte ich verwenden?",
              answer: "Verwenden Sie Ihre offizielle NRW-Schul-E-Mail-Adresse mit Endungen wie .nrw.de, .nrw.schule oder .schulen.de. Diese wird für die Verifizierung Ihrer Berechtigung benötigt."
            },
            {
              question: "Wie sicher ist mein Passwort?",
              answer: "Ihr Passwort muss mindestens 8 Zeichen lang sein und Groß- und Kleinbuchstaben, Zahlen sowie Sonderzeichen enthalten. Wir empfehlen zusätzlich die Aktivierung der Zwei-Faktor-Authentifizierung."
            },
            {
              question: "Was ist SchiLD-Import?",
              answer: "SchiLD ist das Schulverwaltungsprogramm in NRW. Sie können Lehrkraftdaten direkt aus SchiLD exportieren und hier hochladen, anstatt alle E-Mail-Adressen manuell einzugeben."
            },
            {
              question: "Können Lehrkräfte ihre Accounts später selbst verwalten?",
              answer: "Ja, nach der Registrierung können Lehrkräfte ihre Profile selbst verwalten, Passwörter ändern und Sicherheitseinstellungen anpassen."
            },
            {
              question: "Was passiert, wenn eine Lehrkraft die Einladung nicht erhält?",
              answer: "Sie können Einladungen über das Admin-Dashboard erneut versenden oder neue Lehrkräfte jederzeit hinzufügen."
            }
          ];

          const supportBotData = {
            greeting: "Hallo! Ich bin Ihr digitaler NRW.ID Assistent. Ich helfe Ihnen gerne bei Ihrem Onboarding-Prozess. Wie kann ich Ihnen behilflich sein?",
            stepSpecificHelp: {
              0: {
                title: "Hilfe zur E-Mail-Registrierung",
                tips: [
                  "Verwenden Sie Ihre offizielle Schul-E-Mail-Adresse",
                  "Akzeptierte Domains: .nrw.de, .nrw.schule, .schulen.de",
                  "Die E-Mail-Adresse wird zur Verifizierung verwendet"
                ],
                quickResponses: [
                  { text: "Welche E-Mail soll ich verwenden?", response: "Verwenden Sie Ihre offizielle NRW-Schul-E-Mail-Adresse. Diese erkennen Sie an Endungen wie .nrw.de, .nrw.schule oder .schulen.de. Als Schulleitung haben Sie normalerweise eine E-Mail-Adresse wie schulleitung@ihreschule.nrw.de" },
                  { text: "Meine E-Mail wird nicht akzeptiert", response: "Prüfen Sie bitte, ob Ihre E-Mail-Adresse eine der folgenden Endungen hat: .nrw.de, .nrw.schule oder .schulen.de. Falls Sie eine andere dienstliche E-Mail-Adresse haben, wenden Sie sich bitte an den Support." },
                  { text: "Ich habe mehrere E-Mail-Adressen", response: "Verwenden Sie die E-Mail-Adresse, die Sie als Schulleitung für offizielle Kommunikation nutzen. Dies ist meist die Adresse, die auch im SchiLD-System hinterlegt ist." }
                ]
              },
              1: {
                title: "Hilfe zur Passwort-Erstellung",
                tips: [
                  "Mindestens 8 Zeichen erforderlich",
                  "Kombinieren Sie Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen",
                  "Vermeiden Sie persönliche Informationen oder einfache Muster"
                ],
                quickResponses: [
                  { text: "Passwort-Anforderungen", response: "Ihr Passwort muss mindestens 8 Zeichen lang sein und folgende Elemente enthalten: Großbuchstaben, Kleinbuchstaben, Zahlen und Sonderzeichen (!@#$%^&* etc.). Beispiel: 'Schule2024!'" },
                  { text: "Passwort vergessen - was dann?", response: "Nach der Registrierung können Sie über 'Passwort vergessen' auf der Anmeldeseite ein neues Passwort anfordern. Sie erhalten dann eine E-Mail mit einem Reset-Link." },
                  { text: "Sichere Passwort-Tipps", response: "Verwenden Sie eine Kombination aus einem Satz und Zahlen/Sonderzeichen. Beispiel: 'MeineSchuleIstSuper2024!' oder nutzen Sie einen Passwort-Manager für maximale Sicherheit." }
                ]
              },
              2: {
                title: "Hilfe zur Zwei-Faktor-Authentifizierung",
                tips: [
                  "2FA erhöht die Sicherheit Ihres Accounts erheblich",
                  "Empfohlene Apps: Google Authenticator, Microsoft Authenticator, Authy",
                  "Sie können 2FA auch später in den Einstellungen aktivieren"
                ],
                quickResponses: [
                  { text: "Was ist 2FA?", response: "Zwei-Faktor-Authentifizierung (2FA) ist eine zusätzliche Sicherheitsebene. Nach der Passwort-Eingabe müssen Sie einen Code aus einer Authenticator-App eingeben. Dies schützt Ihren Account auch bei kompromittierten Passwörtern." },
                  { text: "Welche App soll ich verwenden?", response: "Ich empfehle Google Authenticator (kostenlos), Microsoft Authenticator oder Authy. Alle sind sicher und einfach zu verwenden. Laden Sie die App herunter, bevor Sie 2FA aktivieren." },
                  { text: "Was wenn ich mein Handy verliere?", response: "Bei der 2FA-Einrichtung erhalten Sie Backup-Codes, die Sie sicher aufbewahren sollten. Mit diesen können Sie sich auch ohne Handy anmelden und die 2FA neu einrichten." }
                ]
              },
              3: {
                title: "Hilfe bei der Lehrkräfte-Einladung",
                tips: [
                  "SchiLD-Import ist die schnellste Methode für viele Lehrkräfte",
                  "CSV oder Excel-Dateien mit Spalten 'E-Mail' und 'Name' werden unterstützt",
                  "Bei manueller Eingabe: eine E-Mail-Adresse pro Zeile"
                ],
                quickResponses: [
                  { text: "Wie funktioniert SchiLD-Import?", response: "Exportieren Sie die Lehrkraftdaten aus SchiLD als CSV oder Excel-Datei. Die Datei sollte mindestens Spalten für 'E-Mail' und 'Name' enthalten. Laden Sie diese Datei dann hier hoch - das System lädt automatisch alle Lehrkräfte ein." },
                  { text: "Manuelle Eingabe vs. SchiLD", response: "SchiLD-Import ist effizienter für viele Lehrkräfte. Manuelle Eingabe eignet sich, wenn Sie nur wenige Lehrkräfte haben oder keinen Zugang zu SchiLD-Exporten haben. Beide Methoden sind gleichwertig." },
                  { text: "Was passiert nach dem Versenden?", response: "Alle eingeladenen Lehrkräfte erhalten eine E-Mail mit einem Link zur Account-Erstellung. Sie können den Status der Registrierungen später im Admin-Dashboard verfolgen und bei Bedarf Erinnerungen versenden." }
                ]
              },
              4: {
                title: "Setup abgeschlossen - Nächste Schritte",
                tips: [
                  "Informieren Sie Ihre Lehrkräfte über die versendeten Einladungen",
                  "Überprüfen Sie regelmäßig den Status im Admin-Dashboard",
                  "Der Support steht für weitere Fragen zur Verfügung"
                ],
                quickResponses: [
                  { text: "Wie geht es weiter?", response: "Ihr Setup ist abgeschlossen! Informieren Sie Ihre Lehrkräfte über die Einladungs-E-Mails. Im Admin-Dashboard können Sie den Registrierungsstatus verfolgen und bei Bedarf Erinnerungen versenden." },
                  { text: "Dashboard-Funktionen", response: "Im Dashboard können Sie: Lehrkräfte-Status überwachen, neue Einladungen versenden, Account-Einstellungen verwalten, Berichte über die Nutzung einsehen und Support-Tickets erstellen." },
                  { text: "Support nach dem Setup", response: "Nach dem Setup erreichen Sie den Support über das Dashboard oder direkt unter support@nrw.id. Für Eilfälle: 0211-837-1234 (Mo-Fr 8-17 Uhr)." }
                ]
              }
            },
            commonQuestions: [
              { 
                question: "Wie lange dauert die Registrierung?", 
                answer: "Die komplette Registrierung dauert etwa 5-10 Minuten. Die Lehrkräfte-Einladungen werden sofort versendet." 
              },
              { 
                question: "Kostet die Nutzung etwas?", 
                answer: "Nein, NRW.ID ist für alle Schulen in Nordrhein-Westfalen kostenlos verfügbar." 
              },
              { 
                question: "Wer kann sich registrieren?", 
                answer: "Registrieren können sich Schulleitungen mit einer gültigen NRW-Schul-E-Mail-Adresse." 
              },
              { 
                question: "Was ist mit dem Datenschutz?", 
                answer: "Alle Daten werden nach DSGVO-Standards verarbeitet und verschlüsselt gespeichert. Mehr Infos in unserer Datenschutzerklärung." 
              }
            ]
          };

          const generateBotResponse = (userInput) => {
            const input = userInput.toLowerCase();
            const currentStepHelp = supportBotData.stepSpecificHelp[currentStep];
            
            // Check for step-specific quick responses first
            if (currentStepHelp) {
              for (const quickResponse of currentStepHelp.quickResponses) {
                if (input.includes(quickResponse.text.toLowerCase()) || 
                    quickResponse.text.toLowerCase().includes(input)) {
                  return quickResponse.response;
                }
              }
            }
            
            // Check common questions
            for (const qa of supportBotData.commonQuestions) {
              if (input.includes(qa.question.toLowerCase().substring(0, 10)) ||
                  qa.question.toLowerCase().includes(input.substring(0, 10))) {
                return qa.answer;
              }
            }
            
            // Keyword matching for help
            if (input.includes('hilfe') || input.includes('help')) {
              return currentStepHelp ? 
                `Hier sind einige Tipps für ${currentStepHelp.title}:\n\n${currentStepHelp.tips.map(tip => `• ${tip}`).join('\n')}\n\nStellen Sie gerne spezifische Fragen!` :
                "Gerne helfe ich Ihnen! Sie können mich zu allen Aspekten des Onboarding-Prozesses fragen.";
            }
            
            if (input.includes('e-mail') || input.includes('email')) {
              return "Verwenden Sie Ihre offizielle NRW-Schul-E-Mail-Adresse mit Endungen wie .nrw.de, .nrw.schule oder .schulen.de. Diese wird für die Verifizierung benötigt.";
            }
            
            if (input.includes('passwort') || input.includes('password')) {
              return "Ihr Passwort muss mindestens 8 Zeichen enthalten: Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen. Beispiel: 'MeineSchule2024!'";
            }
            
            if (input.includes('2fa') || input.includes('authentifizierung')) {
              return "Zwei-Faktor-Authentifizierung erhöht die Sicherheit erheblich. Nutzen Sie Apps wie Google Authenticator oder Microsoft Authenticator. Sie können 2FA auch später aktivieren.";
            }
            
            if (input.includes('schild') || input.includes('import')) {
              return "Mit SchiLD-Import können Sie Lehrkraftdaten direkt hochladen. Exportieren Sie eine CSV/Excel-Datei mit 'E-Mail' und 'Name' Spalten aus SchiLD.";
            }
            
            if (input.includes('support') || input.includes('kontakt')) {
              return "Sie erreichen unseren Support unter:\n📞 0211-837-1234 (Mo-Fr 8-17 Uhr)\n✉️ support@nrw.id\n💬 Live-Chat (Mo-Fr 9-16 Uhr)";
            }
            
            // Default response with step-specific help
            if (currentStepHelp) {
              return `Für ${currentStepHelp.title} kann ich Ihnen helfen. Versuchen Sie eine spezifischere Frage oder wählen Sie eine der Optionen unten.`;
            }
            
            return "Entschuldigung, das habe ich nicht verstanden. Können Sie Ihre Frage anders formulieren? Oder nutzen Sie die Quick-Response-Buttons für häufige Fragen.";
          };

          const handleBotMessage = (message) => {
            if (!message.trim()) return;
            
            const userMsg = { type: 'user', content: message, timestamp: new Date() };
            setBotMessages(prev => [...prev, userMsg]);
            setUserMessage('');
            setBotIsTyping(true);
            
            // Simulate bot thinking time
            setTimeout(() => {
              const botResponse = generateBotResponse(message);
              const botMsg = { type: 'bot', content: botResponse, timestamp: new Date() };
              setBotMessages(prev => [...prev, botMsg]);
              setBotIsTyping(false);
            }, 1000 + Math.random() * 1500);
          };

          const initializeBotChat = () => {
            setShowSupportBot(true);
            if (botMessages.length === 0) {
              setBotMessages([{
                type: 'bot',
                content: supportBotData.greeting,
                timestamp: new Date()
              }]);
            }
          };

          const renderHelpOverlay = () => {
            if (!showHelp) return null;

            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                  <div className="p-6 border-b border-gray-200">
                    <div className="flex justify-between items-center">
                      <h2 className="text-xl font-bold text-gray-900">Hilfe & Anleitung</h2>
                      <button
                        onClick={() => setShowHelp(false)}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        <X className="h-6 w-6" />
                      </button>
                    </div>
                  </div>
                  <div className="p-6 space-y-6">
                    <div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-3">Schritt-für-Schritt Anleitung</h3>
                      <div className="space-y-4">
                        <div className="flex items-start">
                          <div className="bg-blue-100 rounded-full p-2 mr-3 mt-1">
                            <Mail className="h-4 w-4 text-blue-600" />
                          </div>
                          <div>
                            <h4 className="font-medium text-gray-900">1. E-Mail-Adresse eingeben</h4>
                            <p className="text-sm text-gray-600">Verwenden Sie Ihre offizielle NRW-Schul-E-Mail-Adresse für die Verifizierung.</p>
                          </div>
                        </div>
                        <div className="flex items-start">
                          <div className="bg-blue-100 rounded-full p-2 mr-3 mt-1">
                            <Lock className="h-4 w-4 text-blue-600" />
                          </div>
                          <div>
                            <h4 className="font-medium text-gray-900">2. Sicheres Passwort erstellen</h4>
                            <p className="text-sm text-gray-600">Folgen Sie den Sicherheitsanforderungen für ein starkes Passwort.</p>
                          </div>
                        </div>
                        <div className="flex items-start">
                          <div className="bg-blue-100 rounded-full p-2 mr-3 mt-1">
                            <Shield className="h-4 w-4 text-blue-600" />
                          </div>
                          <div>
                            <h4 className="font-medium text-gray-900">3. Zwei-Faktor-Authentifizierung</h4>
                            <p className="text-sm text-gray-600">Aktivieren Sie 2FA für zusätzliche Sicherheit Ihres Schulleitung-Accounts.</p>
                          </div>
                        </div>
                        <div className="flex items-start">
                          <div className="bg-blue-100 rounded-full p-2 mr-3 mt-1">
                            <Users className="h-4 w-4 text-blue-600" />
                          </div>
                          <div>
                            <h4 className="font-medium text-gray-900">4. Lehrkräfte einladen</h4>
                            <p className="text-sm text-gray-600">Laden Sie Lehrkräfte über SchiLD-Import oder manuelle Eingabe ein.</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-3">Wichtige Hinweise</h3>
                      <ul className="text-sm text-gray-600 space-y-2">
                        <li>• Alle Daten werden verschlüsselt übertragen und gespeichert</li>
                        <li>• Die Registrierung ist nur für verifizierte NRW-Schulen möglich</li>
                        <li>• Bei technischen Problemen wenden Sie sich an den Support</li>
                        <li>• Die Aktivierung der 2FA wird dringend empfohlen</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderFAQOverlay = () => {
            if (!showFAQ) return null;

            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                  <div className="p-6 border-b border-gray-200">
                    <div className="flex justify-between items-center">
                      <h2 className="text-xl font-bold text-gray-900">Häufig gestellte Fragen</h2>
                      <button
                        onClick={() => setShowFAQ(false)}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        <X className="h-6 w-6" />
                      </button>
                    </div>
                  </div>
                  <div className="p-6">
                    <div className="space-y-6">
                      {faqData.map((faq, index) => (
                        <div key={index} className="border-b border-gray-200 pb-4 last:border-b-0">
                          <h3 className="font-medium text-gray-900 mb-2">{faq.question}</h3>
                          <p className="text-sm text-gray-600">{faq.answer}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderSupportOverlay = () => {
            if (!showSupport) return null;

            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg max-w-lg w-full">
                  <div className="p-6 border-b border-gray-200">
                    <div className="flex justify-between items-center">
                      <h2 className="text-xl font-bold text-gray-900">Support kontaktieren</h2>
                      <button
                        onClick={() => setShowSupport(false)}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        <X className="h-6 w-6" />
                      </button>
                    </div>
                  </div>
                  <div className="p-6 space-y-6">
                    <div className="text-center">
                      <h3 className="text-lg font-semibold text-gray-900 mb-4">Wir helfen Ihnen gerne!</h3>
                      <p className="text-gray-600 mb-6">Bei Fragen oder Problemen während der Registrierung stehen wir Ihnen zur Verfügung.</p>
                    </div>
                    
                    <div className="space-y-4">
                      <div className="flex items-center p-4 bg-blue-50 rounded-lg">
                        <Phone className="h-6 w-6 text-blue-600 mr-3" />
                        <div>
                          <h4 className="font-medium text-gray-900">Telefon-Support</h4>
                          <p className="text-sm text-gray-600">0211 - 837 1234</p>
                          <p className="text-xs text-gray-500">Mo-Fr: 8:00 - 17:00 Uhr</p>
                        </div>
                      </div>
                      
                      <div className="flex items-center p-4 bg-green-50 rounded-lg">
                        <Mail className="h-6 w-6 text-green-600 mr-3" />
                        <div>
                          <h4 className="font-medium text-gray-900">E-Mail-Support</h4>
                          <p className="text-sm text-gray-600">support@nrw.id</p>
                          <p className="text-xs text-gray-500">Antwort innerhalb von 24 Stunden</p>
                        </div>
                      </div>
                      
                      <div className="flex items-center p-4 bg-purple-50 rounded-lg cursor-pointer hover:bg-purple-100 transition-colors"
                           onClick={() => { setShowSupport(false); initializeBotChat(); }}>
                        <Bot className="h-6 w-6 text-purple-600 mr-3" />
                        <div>
                          <h4 className="font-medium text-gray-900">KI-Assistent</h4>
                          <p className="text-sm text-gray-600">Sofortige intelligente Hilfe</p>
                          <p className="text-xs text-gray-500">24/7 verfügbar - Jetzt starten!</p>
                        </div>
                      </div>
                    </div>
                    
                    <div className="text-center">
                      <button 
                        onClick={() => { setShowSupport(false); initializeBotChat(); }}
                        className="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                      >
                        KI-Assistent starten
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderSupportBotOverlay = () => {
            if (!showSupportBot) return null;

            const currentStepHelp = supportBotData.stepSpecificHelp[currentStep];

            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-end z-50 p-4">
                <div className="bg-white rounded-lg w-96 h-[600px] shadow-2xl flex flex-col">
                  {/* Header */}
                  <div className="p-4 border-b border-gray-200 bg-nrw-blue text-white rounded-t-lg">
                    <div className="flex justify-between items-center">
                      <div className="flex items-center">
                        <Bot className="h-6 w-6 mr-2" />
                        <div>
                          <h3 className="font-semibold">NRW.ID Assistent</h3>
                          <p className="text-xs opacity-90">Ihr persönlicher Onboarding-Helfer</p>
                        </div>
                      </div>
                      <div className="flex items-center space-x-2">
                        <button
                          onClick={() => setShowSupportBot(false)}
                          className="text-white hover:bg-nrw-blue-dark p-1 rounded"
                        >
                          <Minimize2 className="h-4 w-4" />
                        </button>
                        <button
                          onClick={() => setShowSupportBot(false)}
                          className="text-white hover:bg-nrw-blue-dark p-1 rounded"
                        >
                          <X className="h-4 w-4" />
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Messages Area */}
                  <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                    {botMessages.map((message, index) => (
                      <div key={index} className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                        <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
                          message.type === 'user' 
                            ? 'bg-nrw-blue text-white' 
                            : 'bg-white border border-gray-200 text-gray-800'
                        }`}>
                          <p className="text-sm whitespace-pre-wrap">{message.content}</p>
                          <p className={`text-xs mt-1 ${
                            message.type === 'user' ? 'text-blue-100' : 'text-gray-500'
                          }`}>
                            {message.timestamp.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                          </p>
                        </div>
                      </div>
                    ))}
                    
                    {botIsTyping && (
                      <div className="flex justify-start">
                        <div className="bg-white border border-gray-200 px-4 py-2 rounded-lg">
                          <div className="flex space-x-1">
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Quick Response Buttons */}
                  {currentStepHelp && (
                    <div className="p-3 border-t border-gray-200 bg-gray-50">
                      <p className="text-xs text-gray-600 mb-2">Häufige Fragen zu {currentStepHelp.title}:</p>
                      <div className="space-y-1">
                        {currentStepHelp.quickResponses.slice(0, 2).map((qr, index) => (
                          <button
                            key={index}
                            onClick={() => handleBotMessage(qr.text)}
                            className="w-full text-left text-xs bg-white border border-gray-200 rounded px-2 py-1 hover:bg-gray-100 transition-colors"
                          >
                            {qr.text}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Input Area */}
                  <div className="p-4 border-t border-gray-200 bg-white rounded-b-lg">
                    <div className="flex space-x-2">
                      <input
                        type="text"
                        value={userMessage}
                        onChange={(e) => setUserMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleBotMessage(userMessage)}
                        placeholder="Stellen Sie Ihre Frage..."
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nrw-blue text-sm"
                        disabled={botIsTyping}
                      />
                      <button
                        onClick={() => handleBotMessage(userMessage)}
                        disabled={!userMessage.trim() || botIsTyping}
                        className="px-3 py-2 bg-nrw-blue text-white rounded-lg hover:bg-nrw-blue-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        <Send className="h-4 w-4" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderStepContent = () => {
            switch (currentStep) {
              case 0:
                return (
                  <div className="space-y-6">
                    <div className="mb-6">
                      <div className="flex items-center mb-4">
                        <Mail className="h-8 w-8 text-nrw-blue mr-3" />
                        <div>
                          <h2 className="text-2xl font-bold text-gray-900">Anmeldung mit Schul-E-Mail</h2>
                          <p className="text-nrw-gray-dark">Geben Sie Ihre offizielle NRW-Schul-E-Mail-Adresse ein</p>
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Schul-E-Mail-Adresse *
                      </label>
                      <input
                        type="email"
                        value={formData.schoolEmail}
                        onChange={(e) => setFormData({ ...formData, schoolEmail: e.target.value })}
                        className={`w-full px-4 py-3 border rounded focus:ring-2 focus:ring-nrw-blue focus:border-nrw-blue ${
                          errors.schoolEmail ? 'border-red-500 bg-red-50' : 'border-gray-300'
                        }`}
                        placeholder="schulleitung@musterschule.nrw.de"
                      />
                      {errors.schoolEmail && (
                        <div className="flex items-center mt-2 text-red-600">
                          <AlertCircle className="h-4 w-4 mr-1" />
                          <span className="text-sm">{errors.schoolEmail}</span>
                        </div>
                      )}
                      
                      <div className="mt-4 p-4 bg-blue-50 rounded border-l-4 border-nrw-blue">
                        <p className="text-sm text-nrw-blue-dark">
                          <strong>Hinweis:</strong> Verwenden Sie Ihre offizielle NRW-Schul-E-Mail-Adresse 
                          (z.B. mit den Endungen .nrw.de, .nrw.schule oder .schulen.de).
                        </p>
                      </div>
                    </div>
                  </div>
                );

              case 1:
                return (
                  <div className="space-y-6">
                    <div className="text-center">
                      <Lock className="mx-auto h-16 w-16 text-blue-600 mb-4" />
                      <h2 className="text-2xl font-bold text-gray-900 mb-2">Sicheres Passwort erstellen</h2>
                      <p className="text-gray-600">Erstellen Sie ein starkes Passwort für Ihren Account.</p>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Neues Passwort *
                        </label>
                        <div className="relative">
                          <input
                            type={showPassword ? "text" : "password"}
                            value={formData.password}
                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                            className={`w-full px-4 py-3 pr-12 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                              errors.password ? 'border-red-500 bg-red-50' : 'border-gray-300'
                            }`}
                            placeholder="Sicheres Passwort eingeben"
                          />
                          <button
                            type="button"
                            onClick={() => setShowPassword(!showPassword)}
                            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                          >
                            {showPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />}
                          </button>
                        </div>
                        {errors.password && (
                          <div className="flex items-center mt-2 text-red-600">
                            <AlertCircle className="h-4 w-4 mr-1" />
                            <span className="text-sm">{errors.password}</span>
                          </div>
                        )}
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Passwort bestätigen *
                        </label>
                        <div className="relative">
                          <input
                            type={showConfirmPassword ? "text" : "password"}
                            value={formData.confirmPassword}
                            onChange={(e) => setFormData({ ...formData, confirmPassword: e.target.value })}
                            className={`w-full px-4 py-3 pr-12 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                              errors.confirmPassword ? 'border-red-500 bg-red-50' : 'border-gray-300'
                            }`}
                            placeholder="Passwort wiederholen"
                          />
                          <button
                            type="button"
                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                          >
                            {showConfirmPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />}
                          </button>
                        </div>
                        {errors.confirmPassword && (
                          <div className="flex items-center mt-2 text-red-600">
                            <AlertCircle className="h-4 w-4 mr-1" />
                            <span className="text-sm">{errors.confirmPassword}</span>
                          </div>
                        )}
                      </div>

                      <div className="p-4 bg-gray-50 rounded-lg">
                        <h4 className="font-medium text-gray-900 mb-2">Passwort-Anforderungen:</h4>
                        <ul className="text-sm text-gray-600 space-y-1">
                          <li className={`flex items-center ${formData.password.length >= 8 ? 'text-green-600' : ''}`}>
                            <span className="mr-2">{formData.password.length >= 8 ? '✓' : '○'}</span>
                            Mindestens 8 Zeichen
                          </li>
                          <li className={`flex items-center ${/[A-Z]/.test(formData.password) ? 'text-green-600' : ''}`}>
                            <span className="mr-2">{/[A-Z]/.test(formData.password) ? '✓' : '○'}</span>
                            Mindestens ein Großbuchstabe
                          </li>
                          <li className={`flex items-center ${/[a-z]/.test(formData.password) ? 'text-green-600' : ''}`}>
                            <span className="mr-2">{/[a-z]/.test(formData.password) ? '✓' : '○'}</span>
                            Mindestens ein Kleinbuchstabe
                          </li>
                          <li className={`flex items-center ${/[0-9]/.test(formData.password) ? 'text-green-600' : ''}`}>
                            <span className="mr-2">{/[0-9]/.test(formData.password) ? '✓' : '○'}</span>
                            Mindestens eine Zahl
                          </li>
                          <li className={`flex items-center ${/[^A-Za-z0-9]/.test(formData.password) ? 'text-green-600' : ''}`}>
                            <span className="mr-2">{/[^A-Za-z0-9]/.test(formData.password) ? '✓' : '○'}</span>
                            Mindestens ein Sonderzeichen
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                );

              case 2:
                return (
                  <div className="space-y-6">
                    <div className="text-center">
                      <Shield className="mx-auto h-16 w-16 text-green-600 mb-4" />
                      <h2 className="text-2xl font-bold text-gray-900 mb-2">Zwei-Faktor-Authentifizierung</h2>
                      <p className="text-gray-600">Erhöhen Sie die Sicherheit Ihres Accounts durch einen zweiten Faktor.</p>
                    </div>
                    
                    <div className="space-y-4">
                      <div className="p-6 bg-green-50 border border-green-200 rounded-lg">
                        <div className="flex items-start">
                          <Shield className="h-6 w-6 text-green-600 mt-1 mr-3" />
                          <div>
                            <h3 className="font-medium text-green-900 mb-2">Warum Zwei-Faktor-Authentifizierung?</h3>
                            <p className="text-green-700 text-sm mb-3">
                              Die 2FA schützt Ihren Account auch dann, wenn Ihr Passwort kompromittiert wird. 
                              Besonders für Schulleitungs-Accounts wird dies dringend empfohlen.
                            </p>
                            <ul className="text-green-700 text-sm space-y-1">
                              <li>• Schutz vor unbefugtem Zugriff</li>
                              <li>• Sicherheit für sensible Schuldaten</li>
                              <li>• Erfüllung von Datenschutzbestimmungen</li>
                            </ul>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-3">
                        <label className="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                          <input
                            type="radio"
                            name="twoFactor"
                            checked={formData.twoFactorEnabled === true}
                            onChange={() => setFormData({ ...formData, twoFactorEnabled: true })}
                            className="mr-3 h-4 w-4 text-blue-600"
                          />
                          <div>
                            <div className="font-medium text-gray-900">Ja, 2FA aktivieren (empfohlen)</div>
                            <div className="text-sm text-gray-500">Sie erhalten einen QR-Code für Ihre Authenticator-App</div>
                          </div>
                        </label>

                        <label className="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                          <input
                            type="radio"
                            name="twoFactor"
                            checked={formData.twoFactorEnabled === false}
                            onChange={() => setFormData({ ...formData, twoFactorEnabled: false })}
                            className="mr-3 h-4 w-4 text-blue-600"
                          />
                          <div>
                            <div className="font-medium text-gray-900">Später aktivieren</div>
                            <div className="text-sm text-gray-500">Sie können 2FA jederzeit in den Einstellungen aktivieren</div>
                          </div>
                        </label>
                      </div>

                      {formData.twoFactorEnabled && (
                        <div className="p-4 bg-blue-50 rounded-lg">
                          <h4 className="font-medium text-blue-900 mb-2">Empfohlene Authenticator-Apps:</h4>
                          <ul className="text-blue-700 text-sm space-y-1">
                            <li>• Google Authenticator</li>
                            <li>• Microsoft Authenticator</li>
                            <li>• Authy</li>
                          </ul>
                        </div>
                      )}
                    </div>
                  </div>
                );

              case 3:
                return (
                  <div className="space-y-6">
                    <div className="text-center">
                      <Users className="mx-auto h-16 w-16 text-blue-600 mb-4" />
                      <h2 className="text-2xl font-bold text-gray-900 mb-2">Lehrkräfte einladen</h2>
                      <p className="text-gray-600">Laden Sie Ihre Lehrkräfte über SchiLD-Import oder manuelle Eingabe ein.</p>
                    </div>
                    
                    <div className="space-y-4">
                      <div>
                        <h3 className="text-lg font-medium text-gray-900 mb-3">Einladungsmethode wählen:</h3>
                        
                        <div className="space-y-3">
                          <label className="flex items-start p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input
                              type="radio"
                              name="inviteMethod"
                              value="schild"
                              checked={formData.inviteMethod === 'schild'}
                              onChange={(e) => setFormData({ ...formData, inviteMethod: e.target.value })}
                              className="mt-1 mr-3 h-4 w-4 text-blue-600"
                            />
                            <div className="flex-1">
                              <div className="flex items-center">
                                <Upload className="h-5 w-5 text-blue-600 mr-2" />
                                <div className="font-medium text-gray-900">SchiLD-Import (empfohlen)</div>
                              </div>
                              <div className="text-sm text-gray-500 mt-1">
                                Importieren Sie Lehrkraftdaten direkt aus SchiLD (CSV oder Excel)
                              </div>
                            </div>
                          </label>

                          <label className="flex items-start p-4 border rounded-lg cursor-pointer hover:bg-gray-50">
                            <input
                              type="radio"
                              name="inviteMethod"
                              value="manual"
                              checked={formData.inviteMethod === 'manual'}
                              onChange={(e) => setFormData({ ...formData, inviteMethod: e.target.value })}
                              className="mt-1 mr-3 h-4 w-4 text-blue-600"
                            />
                            <div className="flex-1">
                              <div className="flex items-center">
                                <Mail className="h-5 w-5 text-blue-600 mr-2" />
                                <div className="font-medium text-gray-900">Manuelle Eingabe</div>
                              </div>
                              <div className="text-sm text-gray-500 mt-1">
                                Geben Sie E-Mail-Adressen der Lehrkräfte manuell ein
                              </div>
                            </div>
                          </label>
                        </div>

                        {errors.inviteMethod && (
                          <div className="flex items-center mt-2 text-red-600">
                            <AlertCircle className="h-4 w-4 mr-1" />
                            <span className="text-sm">{errors.inviteMethod}</span>
                          </div>
                        )}
                      </div>

                      {formData.inviteMethod === 'schild' && (
                        <div className="p-4 bg-gray-50 rounded-lg">
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            SchiLD-Datei hochladen
                          </label>
                          <input
                            type="file"
                            accept=".csv,.xlsx,.xls"
                            onChange={handleFileUpload}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                          {formData.schildFile && (
                            <div className="mt-2 text-sm text-green-600">
                              ✓ Datei ausgewählt: {formData.schildFile.name}
                            </div>
                          )}
                          {errors.schildFile && (
                            <div className="flex items-center mt-2 text-red-600">
                              <AlertCircle className="h-4 w-4 mr-1" />
                              <span className="text-sm">{errors.schildFile}</span>
                            </div>
                          )}
                          <div className="mt-3 p-3 bg-blue-50 rounded-md">
                            <p className="text-sm text-blue-700">
                              <strong>Hinweis:</strong> Die Datei sollte mindestens die Spalten "E-Mail" und "Name" enthalten. 
                              Unterstützte Formate: CSV, Excel (.xlsx, .xls)
                            </p>
                          </div>
                        </div>
                      )}

                      {formData.inviteMethod === 'manual' && (
                        <div className="p-4 bg-gray-50 rounded-lg">
                          <label className="block text-sm font-medium text-gray-700 mb-2">
                            E-Mail-Adressen der Lehrkräfte
                          </label>
                          <textarea
                            value={formData.teacherEmails}
                            onChange={(e) => setFormData({ ...formData, teacherEmails: e.target.value })}
                            className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                              errors.teacherEmails ? 'border-red-500 bg-red-50' : 'border-gray-300'
                            }`}
                            rows="6"
                            placeholder="max.mustermann@musterschule.nrw.de&#10;anna.schmidt@musterschule.nrw.de&#10;peter.mueller@musterschule.nrw.de"
                          />
                          {errors.teacherEmails && (
                            <div className="flex items-center mt-2 text-red-600">
                              <AlertCircle className="h-4 w-4 mr-1" />
                              <span className="text-sm">{errors.teacherEmails}</span>
                            </div>
                          )}
                          <div className="mt-2 text-sm text-gray-500">
                            Geben Sie eine E-Mail-Adresse pro Zeile ein
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                );

              case 4:
                return (
                  <div className="space-y-6">
                    <div className="text-center">
                      <div className="mx-auto h-16 w-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <Check className="h-8 w-8 text-green-600" />
                      </div>
                      <h2 className="text-2xl font-bold text-gray-900 mb-2">Setup erfolgreich abgeschlossen!</h2>
                      <p className="text-gray-600">Ihr Account wurde erfolgreich eingerichtet und die Einladungen wurden versendet.</p>
                    </div>
                    
                    <div className="space-y-4">
                      <div className="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h3 className="font-medium text-green-900 mb-2">Was passiert als nächstes?</h3>
                        <ul className="text-green-700 text-sm space-y-2">
                          <li>✓ Ihr Schulleitung-Account ist aktiv</li>
                          <li>✓ {formData.twoFactorEnabled ? 'Zwei-Faktor-Authentifizierung ist aktiviert' : 'Sie können 2FA in den Einstellungen aktivieren'}</li>
                          <li>✓ Einladungen wurden an {formData.inviteMethod === 'schild' ? 'die Lehrkräfte aus der SchiLD-Datei' : 'die eingegebenen E-Mail-Adressen'} versendet</li>
                          <li>✓ Die Lehrkräfte erhalten E-Mails mit Anweisungen zur Account-Erstellung</li>
                        </ul>
                      </div>

                      <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 className="font-medium text-blue-900 mb-2">Nächste Schritte:</h3>
                        <ol className="text-blue-700 text-sm space-y-1 list-decimal list-inside">
                          <li>Informieren Sie Ihre Lehrkräfte über die versendeten Einladungen</li>
                          <li>Überprüfen Sie regelmäßig den Status der Account-Erstellungen im Admin-Bereich</li>
                          <li>Bei Fragen steht Ihnen der Support zur Verfügung</li>
                        </ol>
                      </div>

                      <div className="flex justify-center">
                        <button className="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                          Zum Dashboard
                        </button>
                      </div>
                    </div>
                  </div>
                );

              default:
                return null;
            }
          };

          return (
            <div className="min-h-screen bg-nrw-gray">
              {/* NRW Header - Authentic Government Style */}
              <header className="bg-white border-b border-gray-200 shadow-sm">
                <div className="max-w-7xl mx-auto">
                  {/* Top bar with logos */}
                  <div className="border-b border-gray-100 py-3 px-4">
                    <div className="flex justify-between items-center">
                      <div className="flex items-center space-x-6">
                        <div className="flex items-center">
                          <div className="bg-nrw-blue text-white px-3 py-1 text-sm font-bold mr-3">
                            NRW
                          </div>
                          <div className="text-sm">
                            <div className="font-semibold text-gray-900">Land Nordrhein-Westfalen</div>
                          </div>
                        </div>
                        <div className="hidden md:block h-8 w-px bg-gray-300"></div>
                        <div className="hidden md:block text-sm text-gray-700">
                          Ministerium für Schule und Bildung
                        </div>
                      </div>
                      <div className="flex items-center space-x-2 text-xs text-nrw-gray-dark">
                        <button className="hover:text-nrw-blue transition-colors">Barrierefreiheit</button>
                        <span>|</span>
                        <button className="hover:text-nrw-blue transition-colors">Leichte Sprache</button>
                        <span>|</span>
                        <button className="hover:text-nrw-blue transition-colors">Gebärdensprache</button>
                      </div>
                    </div>
                  </div>
                  
                  {/* Main navigation */}
                  <div className="px-4 py-4">
                    <div className="flex justify-between items-center">
                      <div>
                        <h1 className="text-xl font-bold text-nrw-blue mb-1">Schulleitung Onboarding</h1>
                        <p className="text-sm text-nrw-gray-dark">Digitale Schule NRW</p>
                      </div>
                      <nav className="flex items-center space-x-6">
                        <button
                          onClick={() => setShowHelp(true)}
                          className="flex items-center px-3 py-2 text-nrw-gray-dark hover:text-nrw-blue transition-colors text-sm"
                        >
                          <HelpCircle className="h-4 w-4 mr-1" />
                          Hilfe
                        </button>
                        <button
                          onClick={() => setShowFAQ(true)}
                          className="flex items-center px-3 py-2 text-nrw-gray-dark hover:text-nrw-blue transition-colors text-sm"
                        >
                          <MessageCircle className="h-4 w-4 mr-1" />
                          FAQ
                        </button>
                        <button
                          onClick={() => setShowSupport(true)}
                          className="flex items-center px-3 py-2 bg-nrw-blue text-white rounded hover:bg-nrw-blue-dark transition-colors text-sm"
                        >
                          <Phone className="h-4 w-4 mr-1" />
                          Support
                        </button>
                      </nav>
                    </div>
                  </div>
                </div>
              </header>

              {/* Help, FAQ, Support Overlays */}
              {renderHelpOverlay()}
              {renderFAQOverlay()}
              {renderSupportOverlay()}
              {renderSupportBotOverlay()}

              {/* Main Content Container */}
              <main className="max-w-4xl mx-auto px-4 py-8">
                {/* Breadcrumb */}
                <nav className="text-sm text-nrw-gray-dark mb-6">
                  <span>Startseite</span> <span className="mx-1">›</span> 
                  <span>Onboarding</span> <span className="mx-1">›</span> 
                  <span className="text-nrw-blue">Schulleitung registrieren</span>
                </nav>

                {/* Page Header */}
                <div className="mb-8">
                  <h1 className="text-3xl font-bold text-gray-900 mb-3">
                    Account-Registrierung für Schulleitungen
                  </h1>
                  <p className="text-lg text-nrw-gray-dark leading-relaxed">
                    Willkommen bei der digitalen Bildungsplattform NRW. Wir führen Sie durch die Einrichtung 
                    Ihres Schulleitung-Accounts und die Einladung Ihrer Lehrkräfte.
                  </p>
                </div>

                {/* Progress Bar */}
                <div className="mb-8">
                  <div className="flex items-center justify-between mb-6">
                    {steps.map((step, index) => {
                      const StepIcon = step.icon;
                      const isCompleted = index < currentStep;
                      const isCurrent = index === currentStep;
                      
                      return (
                        <div key={index} className="flex flex-col items-center flex-1">
                          <div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 mb-3 ${
                            isCompleted ? 'bg-green-500 border-green-500 text-white' :
                            isCurrent ? 'bg-nrw-blue border-nrw-blue text-white' :
                            'bg-white border-gray-300 text-gray-400'
                          }`}>
                            {isCompleted ? (
                              <Check className="h-6 w-6" />
                            ) : (
                              <StepIcon className="h-6 w-6" />
                            )}
                          </div>
                          <div className="text-center">
                            <div className={`text-sm font-medium mb-1 ${
                              isCurrent ? 'text-nrw-blue' : 
                              isCompleted ? 'text-green-600' : 'text-gray-500'
                            }`}>
                              Schritt {index + 1}
                            </div>
                            <div className={`text-xs ${
                              isCurrent ? 'text-nrw-blue' : 
                              isCompleted ? 'text-green-600' : 'text-gray-400'
                            }`}>
                              {step.title}
                            </div>
                          </div>
                          {index < steps.length - 1 && (
                            <div className={`hidden md:block absolute h-px w-24 mt-6 ml-24 ${
                              index < currentStep ? 'bg-green-500' : 'bg-gray-300'
                            }`} style={{ top: '24px' }}></div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                  
                  <div className="w-full bg-gray-200 rounded-full h-1">
                    <div 
                      className="bg-nrw-blue h-1 rounded-full transition-all duration-500"
                      style={{ width: `${(currentStep / (steps.length - 1)) * 100}%` }}
                    />
                  </div>
                </div>

                {/* Main Content Card */}
                <div className="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
                  <div className="p-8">
                    {renderStepContent()}
                  </div>
                  
                  {/* Navigation Footer */}
                  {currentStep < steps.length && (
                    <div className="bg-nrw-gray border-t border-gray-200 px-8 py-4">
                      <div className="flex justify-between">
                        <button
                          onClick={handleBack}
                          disabled={currentStep === 0}
                          className={`flex items-center px-4 py-2 text-sm font-medium rounded transition-colors ${
                            currentStep === 0 
                              ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                              : 'bg-white text-nrw-gray-dark hover:bg-gray-50 border border-gray-300'
                          }`}
                        >
                          <ChevronLeft className="h-4 w-4 mr-1" />
                          Zurück
                        </button>

                        <button
                          onClick={handleNext}
                          className="flex items-center px-6 py-2 bg-nrw-blue text-white text-sm font-medium rounded hover:bg-nrw-blue-dark transition-colors"
                        >
                          {currentStep === steps.length - 1 ? 'Abschließen' : 'Weiter'}
                          <ChevronRight className="h-4 w-4 ml-1" />
                        </button>
                      </div>
                    </div>
                  )}
                </div>

                {/* Floating Support Bot Button */}
                {!showSupportBot && (
                  <button
                    onClick={initializeBotChat}
                    className="fixed bottom-6 right-6 bg-nrw-blue hover:bg-nrw-blue-dark text-white p-4 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 z-40"
                    title="Starten Sie den KI-Assistenten für sofortige Hilfe"
                  >
                    <Bot className="h-6 w-6" />
                  </button>
                )}
              </main>
            </div>
          );
        };

        ReactDOM.render(React.createElement(OnboardingAssistant), document.getElementById('root'));
    </script>
</body>
</html>